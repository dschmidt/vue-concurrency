import{computed as n,reactive as e,watch as r,getCurrentInstance as t,effectScope as i,onBeforeUnmount as c,onServerPrefetch as u}from"vue";import o from"caf";function s(){return(s=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}return n}).apply(this,arguments)}function a(n,e){(null==e||e>n.length)&&(e=n.length);for(var r=0,t=new Array(e);r<e;r++)t[r]=n[r];return t}function f(n){var e=0;if("undefined"==typeof Symbol||null==n[Symbol.iterator]){if(Array.isArray(n)||(n=function(n,e){if(n){if("string"==typeof n)return a(n,void 0);var r=Object.prototype.toString.call(n).slice(8,-1);return"Object"===r&&n.constructor&&(r=n.constructor.name),"Map"===r||"Set"===r?Array.from(n):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(n,void 0):void 0}}(n)))return function(){return e>=n.length?{done:!0}:{done:!1,value:n[e++]}};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(e=n[Symbol.iterator]()).next.bind(e)}function l(n){return new Promise(function(e){var t=r(n,function(n){null!=n&&(e(n),t&&t())},{immediate:!0})})}var d=function(n){return n._runningInstances.length>=n._maxConcurrency},p=function(n){var e=n._activeInstances[0];e&&e.cancel()},_=function(n){n._enqueuedInstances.forEach(function(n){n.isEnqueued=!1,n.isDropped=!0})};function v(e,r){return r?function(e,r,t){return n(function(){return e().filter(function(n){return n[r]})})}(function(){return e()._instances},r):n(function(){return[]})}function h(e){return n(function(){return e().length})}function g(e){return n(function(){var n=e();return n[n.length-1]})}function m(e){return n(function(){return e()[0]})}function y(n){return e(n)}function b(n){var e="General";n._isDropping&&(e="Drop"),n._isEnqueuing&&(e="Enqueue"),n._isRestartable&&(e="Restartable"),n._isKeepingLatest&&(e="KeepLatest");var r=e+" Task";"General"!==e&&(r=r+" with maxConcurrency "+n._maxConcurrency);var t=n._instances.map(function(n){var e;return n.isSuccessful?e="üçè":n.isRunning||n.isEnqueued?e="üçä":(n.isError||n.isCanceled||n.isDropped)&&(e="üî¥"),{status:e+" "+n.status,value:n.value,error:n.error}});console.log("üö¶ "+r),console.table(t)}function w(n){return"test"===process.env.NODE_ENV?Promise.resolve():new Promise(function(e){return setTimeout(e,n)})}function E(n,e){return new n.CancelToken(function(n){e.pr.catch(function(e){"cancel"===e&&n()})})}function R(n){return C(regeneratorRuntime.mark(function e(r){var t=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.apply(void 0,[r].concat([].slice.call(t,1))));case 1:case"end":return e.stop()}},e)}))}function q(e,r,t){var i,c,u=y({id:t.id,isDropped:!1,isEnqueued:!1,hasStarted:!1,isRunning:!1,isFinished:!1,isCanceling:!1,isCanceled:n(function(){return u.isCanceling&&u.isFinished}),isActive:n(function(){return u.isRunning&&!u.isCanceling}),isSuccessful:!1,isNotDropped:n(function(){return!u.isDropped}),isError:n(function(){return!!u.error}),status:n(function(){var n=[[u.isRunning,"running"],[u.isEnqueued,"enqueued"],[u.isCanceled,"canceled"],[u.isCanceling,"canceling"],[u.isDropped,"dropped"],[u.isError,"error"],[u.isSuccessful,"success"]].find(function(n){return n[0]});return n&&n[1]}),error:null,value:null,cancel:function(n){if((void 0===n?{force:!1}:n).force||(u.isCanceling=!0,u.isEnqueued&&(u.isFinished=!0),u.isEnqueued=!1),u.token&&u._canAbort){u.token.abort("cancel");try{u.token.discard()}catch(n){}u.token=void 0,u._canAbort=!1}},canceledOn:function(n){return n.pr.catch(function(n){u.cancel()}),u},_run:function(){!function(n,e,r,t){var i=new o.cancelToken,c=o(e,i);function u(){n.isRunning=!1,n.isFinished=!0}n.token=i,n.hasStarted=!0,n.isRunning=!0,n.isEnqueued=!1,c.call.apply(c,[n,i].concat(r)).then(function(e){n.value=e,n.isSuccessful=!0,u(),n._deferredObject.resolve(e),n._canAbort=!1,t.onFinish(n)}).catch(function(e){"cancel"!==e&&(n.error=e),u(),n._shouldThrow&&n._deferredObject.reject(e),t.onFinish(n)})}(u,e,r,t)},_handled:!0,_deferredObject:(i={},c=new Promise(function(n,e){i.resolve=n,i.reject=e}),i.promise=c,i),_shouldThrow:!1,_canAbort:!0,then:function(n,e){return u._shouldThrow=!0,u._deferredObject.promise.then(n,e)},catch:function(n,e){return void 0===e&&(e=!0),u._shouldThrow=e,u._deferredObject.promise.catch(n)},finally:function(n){return u._shouldThrow=!0,u._deferredObject.promise.finally(n)}}),s=t.modifiers;return s.drop?u.isDropped=!0:s.enqueue?u.isEnqueued=!0:u._run(),u}function C(e,r){void 0===r&&(r={cancelOnUnmount:!0});var u=t(),o=y({_scope:i(),_isRestartable:!1,_isDropping:!1,_isEnqueuing:!1,_isKeepingLatest:!1,_maxConcurrency:1,_hasConcurrency:n(function(){return o._isRestartable||o._isDropping||o._isEnqueuing||o._isKeepingLatest}),isIdle:n(function(){return!o.isRunning}),isRunning:n(function(){return!!o._instances.find(function(n){return n.isRunning})}),isError:n(function(){return!(!o.last||!o.last.isError)}),_instances:[],_successfulInstances:v(function(){return o},"isSuccessful"),_runningInstances:v(function(){return o},"isRunning"),_enqueuedInstances:v(function(){return o},"isEnqueued"),_notDroppedInstances:v(function(){return o},"isNotDropped"),_activeInstances:v(function(){return o},"isActive"),performCount:h(function(){return o._instances}),last:g(function(){return o._notDroppedInstances}),lastSuccessful:g(function(){return o._successfulInstances}),firstEnqueued:m(function(){return o._enqueuedInstances}),cancelAll:function(n){var e=(void 0===n?{force:!1}:n).force;o._instances.forEach(function(n){try{(e||!n.isDropped&&!n.isFinished)&&n.cancel({force:e})}catch(n){if("cancel"!==n)throw n}})},perform:function(){var n=arguments,r={enqueue:!1,drop:!1};o._hasConcurrency&&d(o)&&(o._isDropping&&(r.drop=!0),o._isRestartable&&p(o),o._isKeepingLatest&&_(o),(o._isEnqueuing||o._isKeepingLatest)&&(r.enqueue=!0));var t=function(){return x(o)},i=o._scope.run(function(){return q(e,[].slice.call(n),{modifiers:r,onFinish:t,scope:o._scope,id:o._instances.length+1})});if(!i)throw new Error("Failed to create new task instance due inactive scope. Perhaps you are trying to run a task bound to destroyed component?");return o._instances=[].concat(o._instances,[i]),i},clear:function(){this.cancelAll({force:!0}),this._instances=[]},destroy:function(){this._scope.stop(),this.clear()},restartable:function(){return o._resetModifierFlags(),o._isRestartable=!0,o},drop:function(){return o._resetModifierFlags(),o._isDropping=!0,o},enqueue:function(){return o._resetModifierFlags(),o._isEnqueuing=!0,o},keepLatest:function(){return o._resetModifierFlags(),o._isKeepingLatest=!0,o},_resetModifierFlags:function(){o._isKeepingLatest=!1,o._isRestartable=!1,o._isEnqueuing=!1,o._isDropping=!1},maxConcurrency:function(n){return o._maxConcurrency=n,o}});return u&&r.cancelOnUnmount&&c(function(){o._instances&&o.destroy()}),o}function x(n){if(n._isEnqueuing||n._isKeepingLatest){var e=n.firstEnqueued;e&&e._run()}}function O(n){return C(regeneratorRuntime.mark(function e(r){var t,i,c,u,o=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.perform.apply(n,[].slice.call(o,1)).canceledOn(r);case 2:t=e.sent,i=f([].slice.call(o,1));case 4:if((c=i()).done){e.next=11;break}return u=c.value,e.next=8,u.perform(t).canceledOn(r);case 8:t=e.sent;case 9:e.next=4;break;case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}},e)}))}function j(){return C(regeneratorRuntime.mark(function n(e){var r,t=arguments,i=arguments;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=[].slice.call(i).map(function(n){return n.perform.apply(n,[].slice.call(t,1)).canceledOn(e)}),n.next=3,Promise.all(r);case 3:return n.abrupt("return",n.sent);case 5:case"end":return n.stop()}},n)}))}function k(){return C(regeneratorRuntime.mark(function n(e){var r,t,i,c,u=arguments;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:r=[],t=f([].slice.call(u));case 2:if((i=t()).done){n.next=11;break}return c=i.value,n.t0=r,n.next=7,c.perform.apply(c,[].slice.call(u,1)).canceledOn(e);case 7:n.t1=n.sent,n.t0.push.call(n.t0,n.t1);case 9:n.next=2;break;case 11:return n.abrupt("return",r);case 12:case"end":return n.stop()}},n)}))}var D=function(){return"undefined"==typeof window};function I(n){n._deferredObject.promise=n.isError?Promise.reject(n.error):Promise.resolve(n.value),n.cancel=function(){},n.canceledOn=function(){return n},n._run=function(){},n.then=function(){var e;return(e=n._deferredObject.promise).then.apply(e,[].slice.call(arguments))},n.catch=function(){var e;return(e=n._deferredObject.promise).catch.apply(e,[].slice.call(arguments))},n.finally=function(){var e;return(e=n._deferredObject.promise).finally.apply(e,[].slice.call(arguments))}}function S(n,e){if(D()){var r=e.perform();return u(function(){try{var t=function(t,i){try{var c=Promise.resolve(r).then(function(){A(n,e)})}catch(n){return}return c&&c.then?c.then(void 0,function(){}):c}();return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(n){return Promise.reject(n)}}),r}return F(n,e).reverse()[0]||e.perform()}function A(e,r){var i=t().$root,c=i&&i.context&&i.context.nuxtState;if(!c)throw new Error("Could not access $root.context.nuxtState");c.vueConcurrency||(c.vueConcurrency={}),c.vueConcurrency[e]=n(function(){return{instances:r._instances}})}function F(n,e){var r=function(n){if(!P())throw Error("Could not access  window.__NUXT__");return P().vueConcurrency[n].value}(n);return r&&(e._instances=r.instances||[],e._instances.forEach(I),function(n){delete P().vueConcurrency[n]}(n)),e._instances}function P(){return window.__NUXT__}function T(n,e){D()?A(n,e):F(n,e)}function L(r){var t=Object.values(r),i=e(s({isRunning:n(function(){return!!t.find(function(n){return n.isRunning})}),isIdle:n(function(){return!i.isRunning}),isError:n(function(){return!!t.find(function(n){return n.isError})})},r));return i}export{E as getCancelToken,b as printTask,w as timeout,R as useAsyncTask,j as useParallelTask,O as usePipeTask,T as useSSRPersistance,k as useSequentialTask,C as useTask,L as useTaskGroup,S as useTaskPrefetch,l as waitForValue};
//# sourceMappingURL=vue-concurrency.module.js.map
